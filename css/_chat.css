/* 包含 PageTalk 聊天界面的所有样式，如消息气泡、输入区域、图片预览、思考动画等。 */

/* 聊天界面样式 */
.chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    overflow: hidden;
    /* 确保聊天容器本身不溢出 */
    padding-bottom: 0;
    /* 移除原有的，由 chat-input 和 selected-tabs-bar 控制 */
}

/* 聊天消息区域 */
.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--spacing-md);
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-md) + 8px);
    /* 进一步增大间距 */
    width: 100%;
    min-height: 0;
    /* 确保可以缩小 */
}

/* 欢迎消息 - 高级精致设计 */
.welcome-message {
    background-color: var(--card-background);
    /* 精致的圆角设计 */
    border-radius: 20px;
    /* 更宽敞的内边距 */
    padding: clamp(16px, 3vw, 24px);
    margin: var(--spacing-lg) auto;
    width: clamp(220px, 85%, 50%);
    /* 多层阴影营造深度感 */
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.04),
        0 2px 4px rgba(0, 0, 0, 0.04),
        0 4px 8px rgba(0, 0, 0, 0.03),
        0 8px 16px rgba(0, 0, 0, 0.02);
    text-align: center;
    /* 精致的边框 */
    border: 1px solid var(--border-color);
    /* 入场动画 */
    animation: welcomeSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    /* 平滑过渡 */
    transition:
        transform 0.25s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
        border-color 0.25s ease;
}

.welcome-message:hover {
    transform: translateY(-2px);
    border-color: rgba(70, 116, 255, 0.2);
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.05),
        0 4px 8px rgba(0, 0, 0, 0.05),
        0 8px 16px rgba(0, 0, 0, 0.04),
        0 16px 32px rgba(0, 0, 0, 0.03);
}

/* 深色模式下欢迎消息的微调 */
body.dark-mode .welcome-message {
    border-color: rgba(255, 255, 255, 0.08);
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.12),
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.03) inset;
}

body.dark-mode .welcome-message:hover {
    border-color: rgba(116, 143, 252, 0.25);
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.15),
        0 4px 8px rgba(0, 0, 0, 0.12),
        0 8px 16px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(116, 143, 252, 0.1);
}

@keyframes welcomeSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }

    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.welcome-message h2 {
    color: var(--primary-color);
    margin-bottom: var(--spacing-sm);
    font-size: clamp(15px, 3.5vw, 18px);
    font-weight: 600;
    letter-spacing: -0.3px;
}

.welcome-message p {
    margin-bottom: var(--spacing-sm);
    font-size: clamp(12px, 3vw, 14px);
    line-height: 1.6;
    color: var(--text-secondary);
}

/* 快捷操作按钮样式 */
.quick-actions {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: clamp(var(--spacing-xs), 2vw, var(--spacing-md));
    margin-top: var(--spacing-md);
}

.quick-action-btn {
    background-color: rgba(49, 123, 245, 0.08);
    border: none;
    border-radius: var(--radius-full);
    padding: var(--spacing-xs) clamp(var(--spacing-xs), 3vw, var(--spacing-md));
    font-size: clamp(11px, 3vw, 13px);
    color: var(--primary-color);
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 500;
    white-space: nowrap;
    transform: scale(1);
    position: relative;
    overflow: hidden;
}

.quick-action-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background-color: rgba(49, 123, 245, 0.1);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
}

.quick-action-btn:hover {
    background-color: rgba(49, 123, 245, 0.15);
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(49, 123, 245, 0.15);
}

.quick-action-btn:hover::before {
    width: 100%;
    height: 100%;
}

.quick-action-btn:active {
    transform: scale(0.98);
}



/* 消息气泡样式优化 */
.message {
    padding: 0;
    /* Base padding is 0, content inside will have its own */
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-md);
    /* Standard bottom margin */
    word-wrap: break-word;
    overflow-wrap: break-word;
    position: relative;
    max-width: 90%;
    width: fit-content;
    /* Allows bubble to shrink to content width */
    box-sizing: border-box;
    /* Important for max-width and padding */
    /* 默认状态 - 为动画做准备 */
    opacity: 0;
    transform: translateY(8px) scale(0.98);
    animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* 消息入场动画 - 更丝滑的缓动曲线 */
@keyframes messageSlideIn {
    0% {
        opacity: 0;
        transform: translateY(8px) scale(0.98);
    }

    60% {
        opacity: 0.8;
        transform: translateY(-1px) scale(1.01);
    }

    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* 用户消息特殊入场动画 - 从右侧滑入 */
.user-message {
    animation: userMessageSlideIn 0.35s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes userMessageSlideIn {
    0% {
        opacity: 0;
        transform: translateX(12px) translateY(4px) scale(0.95);
    }

    100% {
        opacity: 1;
        transform: translateX(0) translateY(0) scale(1);
    }
}

/* 机器人消息特殊入场动画 - 从左侧滑入 */
.bot-message {
    animation: botMessageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes botMessageSlideIn {
    0% {
        opacity: 0;
        transform: translateX(-8px) translateY(6px) scale(0.96);
    }

    100% {
        opacity: 1;
        transform: translateX(0) translateY(0) scale(1);
    }
}

/* 用户消息气泡样式 - 高级精致设计 */
.user-message {
    align-self: flex-end;
    background-color: var(--primary-color);
    color: white;
    /* 精致的圆角设计 - 四等圆角 */
    border-radius: 18px;
    display: inline-block;
    max-width: 85%;
    width: auto;
    overflow: visible;
    /* 更宽敞的内边距，提升阅读体验 */
    padding: 12px 16px;
    text-align: left;
    position: relative;
    /* 多层阴影营造深度感 */
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.07),
        0 2px 4px rgba(0, 0, 0, 0.07),
        0 4px 8px rgba(0, 0, 0, 0.07),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    /* 平滑的过渡效果 */
    transition:
        transform 0.25s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

.user-message:hover {
    transform: translateY(-2px);
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.1),
        0 8px 16px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.15) inset;
}

/* 深色模式下用户消息的微调 */
body.dark-mode .user-message {
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.15),
        0 2px 4px rgba(0, 0, 0, 0.12),
        0 4px 8px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.08) inset;
}

body.dark-mode .user-message:hover {
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.2),
        0 4px 8px rgba(0, 0, 0, 0.15),
        0 8px 16px rgba(0, 0, 0, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.12) inset;
}

/* 隐藏没有内容的用户消息气泡 */
.user-message.empty-bubble {
    display: none;
}

/* 用户消息气泡内已发送标签页的容器 - 现在是外部容器的样式 */
.sent-tabs-container,
.sent-images-container {
    display: flex;
    flex-direction: column;
    align-self: flex-end;
    /* 与用户消息气泡对齐 */
    gap: calc(var(--spacing-xs) / 2);
    margin-bottom: calc(var(--spacing-xs) / 2);
    /* 与下方用户消息气泡的间距 */
    width: fit-content;
    /* 根据内容调整宽度 */
    max-width: 90%;
    /* 与用户消息气泡最大宽度相似或略小 */
    margin-right: 0;
    /* 确保与 flex-end 对齐 */
}

/* 为图片容器添加特定的内边距和背景，使其看起来更像一个整体 */
.sent-images-container {
    background-color: rgba(0, 0, 0, 0.03);
    /* 非常淡的背景 */
    padding: var(--spacing-xs);
    border-radius: var(--radius-md);
    box-sizing: border-box;
}

body.dark-mode .sent-images-container {
    background-color: rgba(255, 255, 255, 0.03);
}

.sent-tab-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    /* 增加间距 */
    padding: var(--spacing-sm) var(--spacing-md);
    /* 增加内边距，让标签更宽敞 */
    border-radius: 16px;
    /* 使用16px圆角 */
    background-color: rgba(255, 255, 255, 0.85);
    /* 增加透明度 */
    border: 1px solid rgba(233, 236, 239, 0.6);
    /* 边框也增加透明度 */
    max-width: 100%;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
    /* 更精致的阴影 */
    color: var(--text-color);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 32px;
    /* 确保最小高度 */
    backdrop-filter: blur(8px);
    /* 添加毛玻璃效果 */
    -webkit-backdrop-filter: blur(8px);
    /* Safari兼容性 */
}

.sent-tab-item:hover {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
    border-color: rgba(70, 116, 255, 0.6);
    /* 悬停时边框颜色也带透明度 */
    background-color: rgba(255, 255, 255, 0.95);
    /* 悬停时稍微减少透明度 */
}

/* 深色模式下的透明度调整 */
body.dark-mode .sent-tab-item {
    background-color: rgba(44, 46, 51, 0.85);
    /* 深色模式下的透明背景 */
    border-color: rgba(52, 58, 64, 0.6);
    /* 深色模式下的透明边框 */
}

body.dark-mode .sent-tab-item:hover {
    background-color: rgba(44, 46, 51, 0.95);
    /* 深色模式悬停时稍微减少透明度 */
    border-color: rgba(116, 143, 252, 0.6);
    /* 深色模式悬停边框 */
}

.sent-tab-favicon {
    width: 18px;
    /* 稍微增加图标大小 */
    height: 18px;
    /* 稍微增加图标大小 */
    object-fit: contain;
    flex-shrink: 0;
    border-radius: 3px;
    background-color: var(--background-color);
    padding: 1px;
}

.sent-tab-title {
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
    /* Allow title to take available space */
    flex-shrink: 1;
    /* Allow title to shrink */
    min-width: 0;
    /* Critical for ellipsis to work in flex item */
    position: relative;
    line-height: 1.4;
    color: var(--text-color);
    padding: 2px 0;
    /* 增加垂直内边距，让文字区域更高 */
}

/* "Remove Sent Tab" button in user message bubble */
.remove-sent-tab-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    padding: 4px;
    margin-left: var(--spacing-xs);
    cursor: pointer;
    line-height: 1;
    opacity: 0.6;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    align-self: center;
    /* Vertically center if tab item is taller */
    flex-shrink: 0;
    /* Ensure the button does not shrink */
    border-radius: 8px;
    /* 使用8px圆角，与整体风格协调 */
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.remove-sent-tab-btn:hover {
    color: var(--error-color);
    opacity: 1;
    transform: scale(1.05);
    background-color: rgba(201, 42, 42, 0.15);
    /* 稍微增加透明度 */
}

.remove-sent-tab-btn:active {
    transform: scale(0.95);
}

/* SVG图标样式 */
.remove-sent-tab-btn svg {
    width: 12px;
    height: 12px;
    transition: inherit;
}

/* 可选：为 sent-tab-title 添加更平滑的渐变省略（如果纯 ellipsis 不够） */
/*
.sent-tab-title::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 20px;
    background: linear-gradient(to right, transparent, var(--primary-color) 80%);
}
.user-message:not(:hover) .sent-tab-title::after {
     background: linear-gradient(to right, transparent, var(--primary-color) 80%); 
}
*/

.user-message p {
    margin: 0;
    padding: 0;
    line-height: 1.4;
}

/* 机器人消息气泡样式 - 高级精致设计 */
.bot-message {
    align-self: flex-start;
    background-color: var(--card-background);
    /* 精致的边框处理 */
    border: 1px solid var(--border-color);
    /* 精致的圆角设计 - 四等圆角 */
    border-radius: 18px;
    /* 更宽敞的内边距 */
    padding: 14px 16px;
    padding-bottom: 36px;
    max-width: 90%;
    overflow: visible;
    line-height: 1.5;
    position: relative;
    /* 多层阴影营造深度感 */
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.04),
        0 2px 4px rgba(0, 0, 0, 0.04),
        0 4px 8px rgba(0, 0, 0, 0.02);
    /* 平滑的过渡效果 */
    transition:
        transform 0.25s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
        border-color 0.25s ease;
}

.bot-message:hover {
    transform: translateY(-2px);
    border-color: rgba(70, 116, 255, 0.25);
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.06),
        0 4px 8px rgba(0, 0, 0, 0.06),
        0 8px 16px rgba(0, 0, 0, 0.04),
        0 0 0 1px rgba(70, 116, 255, 0.08);
}

/* 深色模式下机器人消息的微调 */
body.dark-mode .bot-message {
    border-color: rgba(255, 255, 255, 0.08);
    box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.12),
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.04) inset;
}

body.dark-mode .bot-message:hover {
    border-color: rgba(116, 143, 252, 0.3);
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.15),
        0 4px 8px rgba(0, 0, 0, 0.12),
        0 8px 16px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(116, 143, 252, 0.15);
}

.bot-message p {
    margin-top: 0;
    margin-bottom: 0.6em;
    /* Spacing between paragraphs in bot message */
    line-height: 1.4;
}

.bot-message p:last-child {
    margin-bottom: 0;
}

.bot-message p+p::before {
    /* Remove extra space if any was added by browser */
    content: none;
    display: none;
    height: 0;
}

/* 消息操作按钮容器 */
.message-actions {
    position: absolute;
    display: flex;
    gap: 4px;
    /* Reduced gap */
    opacity: 0;
    /* Default hidden */
    transform: translateY(2px) scale(0.9);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 5;
}

/* 用户消息中按钮位置调整到气泡下方 */
.user-message .message-actions {
    bottom: -24px;
    right: 0;
}

/* 机器人消息中按钮位置保持在气泡内右下角 */
.bot-message .message-actions {
    bottom: var(--spacing-xs);
    right: var(--spacing-xs);
}

/* 消息悬停时显示操作按钮 */
.message:hover .message-actions,
.message-actions:hover {
    /* 保持原有样式 */
    opacity: 1;
    transform: translateY(2px) scale(1);
    /* Modified to remove upward lift */
}

/* 通用消息操作按钮样式 (复制、删除、重新生成) */
.message-action-btn {
    width: 24px;
    height: 24px;
    border-radius: var(--radius-full);
    background-color: rgba(255, 255, 255, 0.9);
    /* 浅色模式背景 */
    border: none;
    /* 确保无边框 */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0;
    color: #888;
    /* 默认灰色 */
    backdrop-filter: blur(8px);
}

.message-action-btn:hover {
    transform: scale(1.1);
    color: var(--primary-color);
    /* Default hover to primary color */
    background-color: rgba(255, 255, 255, 0.95);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.message-action-btn:active {
    transform: scale(0.95);
}

/* 用户消息内的按钮特定背景颜色 */
.user-message .message-action-btn {
    background-color: rgba(255, 255, 255, 0.3);
    color: rgba(104, 103, 103, 0.8);
}

.user-message .message-action-btn:hover {
    background-color: rgba(255, 255, 255, 0.6);
    color: var(--primary-color);
    /* User message action buttons also hover to primary */
}

/* 聊天消息中删除操作按钮的特定悬停样式 (现在与用户消息操作按钮悬停一致) */
.message-action-btn.delete-message-action:hover {
    background-color: rgba(255, 255, 255, 0.6);
    /* 白色背景，与用户消息按钮悬停一致 */
    color: var(--primary-color);
    /* 主题色图标，与用户消息按钮悬停一致 */
}

/* 复制按钮基础样式 - 使 message-action-btn 行为一致 */
.copy-button {
    width: 24px;
    height: 24px;
    border-radius: var(--radius-full);
    background-color: rgba(255, 255, 255, 0.9);
    /* 浅色模式背景 (与 message-action-btn 一致) */
    border: none;
    /* 非常重要：移除浏览器默认边框 */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    color: #888;
    /* 默认灰色 (与 message-action-btn 一致) */
}

.copy-button:hover {
    /* 通用复制按钮悬停效果 */
    transform: scale(1.05);
    color: var(--primary-color);
    background-color: white;
    /* 稍微变亮一点的背景以示区别 */
}

/* Ensure copy button inside message actions is part of flex layout */
.message-actions .copy-button {
    position: static !important;
    bottom: auto;
    right: auto;
    /* 继承上述 .copy-button 的基础样式 */
}

/* 用户消息中的复制按钮特定样式 (覆盖基础 .copy-button 样式) */
.user-message .copy-button {
    background-color: rgba(255, 255, 255, 0.3);
    /* 用户消息气泡中的按钮背景 */
    color: rgba(104, 103, 103, 0.8);
    /* 用户消息气泡中的按钮颜色 */
}

.user-message .copy-button:hover {
    background-color: rgba(255, 255, 255, 0.6);
    /* 用户消息气泡中按钮悬停背景 */
    color: var(--primary-color);
    /* 保持悬停颜色一致 */
}

/* 打字机效果 - 多层递进式渐变，更加丝滑 */
.streaming-text-fade {
    display: inline;
}

/* 第一段：最早出现的字符，已接近完全显示 */
.streaming-text-fade-1 {
    animation: streamingFade1 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* 第二段：中间字符，中等透明度 */
.streaming-text-fade-2 {
    animation: streamingFade2 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* 第三段：最新字符，从很低透明度开始 */
.streaming-text-fade-3 {
    animation: streamingFade3 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes streamingFade1 {
    from {
        opacity: 0.7;
    }

    to {
        opacity: 1;
    }
}

@keyframes streamingFade2 {
    from {
        opacity: 0.4;
        filter: blur(0.3px);
    }

    to {
        opacity: 1;
        filter: blur(0);
    }
}

@keyframes streamingFade3 {
    from {
        opacity: 0.1;
        filter: blur(0.8px);
    }

    to {
        opacity: 1;
        filter: blur(0);
    }
}


/* AI思考动画样式 - 更高级的设计 */
.thinking {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-md);
    min-height: 40px;
    /* 添加思考状态的入场动画 - 只播放一次后保持显示 */
    animation: thinkingAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    position: relative;
    /* 确保初始状态是可见的 */
    opacity: 1;
    transform: translateY(0) scale(1);
}

@keyframes thinkingAppear {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.thinking-dots {
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
}

/* 添加背景光晕效果 */
.thinking-dots::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 20px;
    background: radial-gradient(ellipse, rgba(49, 123, 245, 0.15) 0%, transparent 70%);
    border-radius: 50%;
    animation: thinkingGlow 2s infinite ease-in-out;
}

@keyframes thinkingGlow {

    0%,
    100% {
        opacity: 0.3;
        transform: translate(-50%, -50%) scale(1);
    }

    50% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(1.2);
    }
}

.thinking-dots span {
    display: inline-block;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), rgba(49, 123, 245, 0.7));
    opacity: 0.4;
    position: relative;
    z-index: 1;
    box-shadow: 0 1px 3px rgba(49, 123, 245, 0.2);
}

.thinking-dots span:nth-child(1) {
    animation: thinkingPulseAdvanced 1.6s infinite cubic-bezier(0.4, 0, 0.6, 1);
    animation-delay: 0s;
}

.thinking-dots span:nth-child(2) {
    animation: thinkingPulseAdvanced 1.6s infinite cubic-bezier(0.4, 0, 0.6, 1);
    animation-delay: 0.2s;
}

.thinking-dots span:nth-child(3) {
    animation: thinkingPulseAdvanced 1.6s infinite cubic-bezier(0.4, 0, 0.6, 1);
    animation-delay: 0.4s;
}

@keyframes thinkingPulseAdvanced {

    0%,
    60%,
    100% {
        transform: scale(0.8) translateY(0);
        opacity: 0.4;
        box-shadow: 0 1px 3px rgba(49, 123, 245, 0.2);
    }

    30% {
        transform: scale(1.3) translateY(-2px);
        opacity: 1;
        box-shadow: 0 3px 8px rgba(49, 123, 245, 0.4);
    }
}

/* 添加额外的微粒效果 */
.thinking-dots span::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: inherit;
    opacity: 0;
    animation: thinkingRipple 1.6s infinite cubic-bezier(0.4, 0, 0.6, 1);
}

.thinking-dots span:nth-child(1)::after {
    animation-delay: 0s;
}

.thinking-dots span:nth-child(2)::after {
    animation-delay: 0.2s;
}

.thinking-dots span:nth-child(3)::after {
    animation-delay: 0.4s;
}

@keyframes thinkingRipple {
    0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.6;
    }

    100% {
        transform: translate(-50%, -50%) scale(2.5);
        opacity: 0;
    }
}

/* ============================================
   聊天输入区域 - 重构版
   ============================================ */

/* 输入区域包装器 - 与 footer 分离，透明背景 */
.chat-input-wrapper {
    padding: var(--spacing-sm) var(--spacing-md);
    padding-bottom: calc(var(--spacing-md) + 4px);
    background: transparent;
}

/* 输入框容器 */
.chat-input {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
    background-color: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: var(--spacing-sm);
    box-sizing: border-box;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.chat-input:focus-within {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(49, 123, 245, 0.1);
}

/* 输入框 */
.chat-input textarea {
    flex: 1;
    border: none;
    background: transparent;
    padding: 4px 8px;
    resize: none;
    min-height: 24px;
    max-height: 150px;
    font-size: 14px;
    line-height: 1.5;
    outline: none;
    overflow-y: auto;
    color: var(--text-color);
    caret-color: var(--text-color);
}

.chat-input textarea::placeholder {
    color: #999;
}

.chat-input textarea::-webkit-scrollbar {
    width: 6px;
}

.chat-input textarea::-webkit-scrollbar-track {
    background: transparent;
}

.chat-input textarea::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: var(--radius-full);
}

/* 控件行 */
.chat-input-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    position: relative;
}

/* 输入区域通用按钮 */
.input-action-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background-color: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.input-action-btn:hover {
    color: var(--primary-color);
    background-color: var(--button-hover-bg);
}

/* 加号菜单弹出层 */
.attachment-menu {
    display: none;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 0;
    background-color: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    min-width: 160px;
    z-index: 100;
    overflow: hidden;
    padding: 6px 0;
}

.attachment-menu.show {
    display: block;
    animation: menuSlideUp 0.15s ease-out;
}

@keyframes menuSlideUp {
    from {
        opacity: 0;
        transform: translateY(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.attachment-menu-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    width: 100%;
    padding: 10px 14px;
    border: none;
    background: transparent;
    color: var(--text-color);
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.15s ease;
    text-align: left;
}

.attachment-menu-item:hover {
    background-color: var(--button-hover-bg);
}

.attachment-menu-item svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    color: var(--text-secondary);
}

.attachment-menu-item:hover svg {
    color: var(--primary-color);
}

/* 扁平化模型选择器 */
.inline-model-selector {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    margin-left: var(--spacing-sm);
    border: 1px solid transparent;
    border-radius: 12px;
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.inline-model-selector:hover {
    background-color: rgba(49, 123, 245, 0.08);
    color: var(--primary-color);
}

.inline-model-selector.active {
    background-color: rgba(49, 123, 245, 0.1);
    border-color: var(--primary-color);
    color: var(--primary-color);
}

#current-model-display {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.model-display-icon {
    width: 14px;
    height: 14px;
    object-fit: contain;
    flex-shrink: 0;
}

.inline-model-selector svg {
    flex-shrink: 0;
    transition: transform 0.2s ease;
}

.inline-model-selector.active svg {
    transform: rotate(180deg);
}

/* 自定义模型选择菜单 */
.model-selector-menu {
    display: none;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 36px;
    background-color: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    max-height: 280px;
    min-width: 200px;
    max-width: 320px;
    overflow-y: auto;
    z-index: 100;
    padding: 6px 0;
}

.model-selector-menu.show {
    display: block;
    animation: menuSlideUp 0.15s ease-out;
}

/* 模型菜单分组 */
.model-group {
    padding: var(--spacing-xs) 0;
}

.model-group:not(:last-child) {
    border-bottom: 1px solid var(--border-color);
}

.model-group-label {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.provider-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    opacity: 0.9;
}

.provider-icon-img {
    width: 14px;
    height: 14px;
    object-fit: contain;
}

.provider-icon-svg {
    width: 14px;
    height: 14px;
}


.model-option {
    display: flex;
    align-items: center;
    width: 100%;
    padding: 8px 14px;
    border: none;
    background: transparent;
    color: var(--text-color);
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.15s ease;
    text-align: left;
}

.model-option:hover {
    background-color: var(--button-hover-bg);
}

.model-option.selected {
    color: var(--primary-color);
    font-weight: 500;
}

.model-option.selected::before {
    content: '✓';
    margin-right: 8px;
    font-size: 12px;
}

/* 发送按钮 */
#send-message {
    --send-btn-size: 32px;
    --send-accent: var(--primary-color);
    --send-ring-color: rgba(70, 116, 255, 0.28);
    --send-bg: rgba(70, 116, 255, 0.18);
    --send-bg-hover: rgba(70, 116, 255, 0.24);
    --send-bg-active: rgba(70, 116, 255, 0.16);
    --send-border: rgba(70, 116, 255, 0.30);
    --send-border-hover: rgba(70, 116, 255, 0.40);
    --send-highlight: linear-gradient(135deg, rgba(255, 255, 255, 0.42), rgba(255, 255, 255, 0));
    --send-shadow: 0 8px 18px rgba(0, 0, 0, 0.10);
    --send-shadow-hover: 0 12px 26px rgba(0, 0, 0, 0.12);
    --send-shadow-active: 0 6px 14px rgba(0, 0, 0, 0.10);

    width: var(--send-btn-size);
    height: var(--send-btn-size);
    margin-left: auto;
    flex-shrink: 0;

    display: flex;
    align-items: center;
    justify-content: center;

    border: 1px solid var(--send-border);
    border-radius: var(--radius-full);
    background-color: var(--send-bg);
    background-image: var(--send-highlight);
    color: var(--send-accent);

    cursor: pointer;
    position: relative;
    overflow: hidden;

    backdrop-filter: blur(10px) saturate(160%);
    -webkit-backdrop-filter: blur(10px) saturate(160%);

    box-shadow: var(--send-shadow);
    transition: transform 0.12s ease, box-shadow 0.12s ease, background-color 0.12s ease, border-color 0.12s ease, color 0.12s ease;
}

#send-message:hover {
    transform: translateY(-1px);
    background-color: var(--send-bg-hover);
    border-color: var(--send-border-hover);
    box-shadow: var(--send-shadow-hover);
}

#send-message:hover:not(.stop-streaming) {
    --send-accent: var(--primary-hover);
}

#send-message:active {
    transform: translateY(0);
    background-color: var(--send-bg-active);
    box-shadow: var(--send-shadow-active);
}

#send-message:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--send-ring-color), var(--send-shadow-hover);
}

#send-message:disabled {
    background-color: var(--button-secondary-bg);
    background-image: none;
    border-color: var(--border-color);
    box-shadow: none;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    cursor: not-allowed;
    transform: none;
    color: var(--button-secondary-text);
}

#send-message .send-icon {
    width: 16px;
    height: 16px;
    position: absolute;
    inset: 0;
    margin: auto;
    z-index: 1;
    transition: opacity 0.12s ease, transform 0.12s ease;
}

#send-message .send-icon--send {
    opacity: 1;
    transform: translateX(0) scale(1);
}

#send-message:hover .send-icon--send {
    transform: translateX(0.6px) scale(1);
}

#send-message .send-icon--stop {
    opacity: 0;
    transform: scale(0.92);
}

#send-message.stop-streaming {
    --send-accent: var(--danger-color);
    --send-ring-color: rgba(250, 82, 82, 0.24);
    --send-bg: rgba(250, 82, 82, 0.14);
    --send-bg-hover: rgba(250, 82, 82, 0.18);
    --send-bg-active: rgba(250, 82, 82, 0.12);
    --send-border: rgba(250, 82, 82, 0.30);
    --send-border-hover: rgba(250, 82, 82, 0.42);
}

#send-message.stop-streaming:hover {
    --send-accent: var(--danger-hover);
}

#send-message.stop-streaming .send-icon--send {
    opacity: 0;
    transform: scale(0.92);
}

#send-message.stop-streaming .send-icon--stop {
    opacity: 1;
    transform: scale(1);
}

#send-message.stop-streaming:focus-visible {
    box-shadow: 0 0 0 3px var(--send-ring-color), var(--send-shadow-hover);
}

body.dark-mode #send-message {
    --send-ring-color: rgba(116, 143, 252, 0.30);
    --send-bg: rgba(116, 143, 252, 0.22);
    --send-bg-hover: rgba(116, 143, 252, 0.28);
    --send-bg-active: rgba(116, 143, 252, 0.18);
    --send-border: rgba(116, 143, 252, 0.34);
    --send-border-hover: rgba(116, 143, 252, 0.44);
    --send-highlight: linear-gradient(135deg, rgba(255, 255, 255, 0.20), rgba(255, 255, 255, 0));
    --send-shadow: 0 10px 22px rgba(0, 0, 0, 0.28);
    --send-shadow-hover: 0 14px 28px rgba(0, 0, 0, 0.32);
    --send-shadow-active: 0 8px 18px rgba(0, 0, 0, 0.26);
}

body.dark-mode #send-message.stop-streaming {
    --send-ring-color: rgba(250, 82, 82, 0.26);
    --send-bg: rgba(250, 82, 82, 0.14);
    --send-bg-hover: rgba(250, 82, 82, 0.18);
    --send-bg-active: rgba(250, 82, 82, 0.12);
    --send-border: rgba(250, 82, 82, 0.30);
    --send-border-hover: rgba(250, 82, 82, 0.42);
}

/* 发送按钮点击时的脉冲效果 */
@keyframes sendPulse {
    0% {
        box-shadow: 0 0 0 0 var(--send-ring-color), var(--send-shadow);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(0, 0, 0, 0), var(--send-shadow);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0), var(--send-shadow);
    }
}

#send-message.sending {
    animation: sendPulse 0.55s ease-out;
}

@media (prefers-reduced-motion: reduce) {
    #send-message {
        transition: none;
    }

    #send-message .send-icon {
        transition: none;
    }

    #send-message:hover,
    #send-message:active {
        transform: none;
    }

    #send-message:hover .send-icon--send {
        transform: translateX(0) scale(1);
    }

    #send-message.sending {
        animation: none;
    }
}

/* 模型菜单滚动条 */
.model-selector-menu::-webkit-scrollbar {
    width: 6px;
}

.model-selector-menu::-webkit-scrollbar-track {
    background: transparent;
}

.model-selector-menu::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: var(--radius-full);
}


/* 图片预览容器 */
.image-preview-container {
    margin: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    background-color: var(--card-background);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
    max-width: 100%;
    box-sizing: border-box;
}

/* 图片网格布局 */
.images-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: var(--spacing-xs);
    padding: var(--spacing-xs);
}

.image-item {
    position: relative;
    height: 100px;
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.image-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.image-item .image-actions {
    position: absolute;
    top: var(--spacing-xs);
    right: var (--spacing-xs);
    display: flex;
    gap: var(--spacing-xs);
    opacity: 0;
    transition: opacity 0.2s ease;
}

.image-item:hover .image-actions {
    opacity: 1;
}

/* 图片预览操作按钮 */
.image-action-button {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-full);
    border: none;
    background-color: rgba(255, 255, 255, 0.9);
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.image-action-button:hover {
    background-color: white;
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.image-action-button svg {
    width: 16px;
    height: 16px;
}

/* 用户消息中的图片网格 */
/* 修改选择器，不再局限于 .user-message 内部 */
.message-images {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: var(--spacing-xs);
    /* margin-bottom is now controlled by the container's gap */
}

.message-image {
    width: 100%;
    height: 80px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    object-fit: cover;
    display: block;
    /* 确保图片是块级元素 */
}



/* 图片全屏预览模态框 */
.image-modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    overflow: auto;
    padding: 30px;
    box-sizing: border-box;
}

.modal-content {
    /* For image modal specifically */
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 80vh;
    object-fit: contain;
}

.close-modal {
    /* For image modal close button */
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 101;
    /* Above modal content */
}

.close-modal:hover {
    color: var(--primary-color);
    text-decoration: none;
}

/* 带有图像的输入框样式调整 */
.has-image #user-input {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

/* 剪贴板粘贴视觉反馈 */
.paste-highlight {
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 2px rgba(49, 123, 245, 0.2) !important;
}


/* 聊天界面头部 - 简化版 */
.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--panel-background);
    gap: var(--spacing-sm);
    box-sizing: border-box;
}

/* Agent 选择器 */
.chat-agent-selector {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    min-width: 0;
}

.chat-agent-selector label {
    font-size: 12px;
    color: var(--text-secondary);
    white-space: nowrap;
    flex-shrink: 0;
}

.chat-agent-selector select {
    max-width: 120px;
    padding: 4px 8px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    font-size: 12px;
    font-family: inherit;
    background-color: transparent;
    cursor: pointer;
    outline: none;
    transition: all 0.2s ease;
    text-overflow: ellipsis;
}

.chat-agent-selector select:hover {
    border-color: var(--primary-color);
}

.chat-agent-selector select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(49, 123, 245, 0.1);
}


/* 操作按钮组 */
.chat-header-actions {
    display: flex;
    gap: var(--spacing-xs);
    flex-shrink: 0;
}

.chat-header .action-button {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    border: none;
    background-color: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.chat-header .action-button:hover {
    color: var(--primary-color);
    background-color: var(--button-hover-bg);
}



/* 新增聊天界面状态消息样式 */
.chat-status {
    padding: var(--spacing-sm) var(--spacing-md);
    margin: 0 auto var(--spacing-sm) auto;
    /* 上0 左右auto 下SM */
    border-radius: var(--radius-md);
    font-size: 13px;
    text-align: center;
    display: none;
    /* 默认隐藏 */
    opacity: 0;
    transform: translateY(-20px);
    /* 向上移动更多 */
    transition: all 0.3s ease;
    max-width: 300px;
    /* 限制气泡最大宽度 */
}

.chat-status.success {
    display: block;
    opacity: 1;
    transform: translateY(-15px);
    /* 调整出现时的位置 */
    background-color: rgba(52, 168, 83, 0.1);
    color: var(--success-color);
    border: 1px solid rgba(52, 168, 83, 0.3);
}

.chat-status.error {
    display: block;
    opacity: 1;
    transform: translateY(-15px);
    /* 调整出现时的位置 */
    background-color: rgba(234, 67, 53, 0.1);
    color: var(--error-color);
    border: 1px solid rgba(234, 67, 53, 0.3);
}

/* 空状态消息 (if used in chat, e.g., for empty agent list, but that's in settings) */
.empty-state {
    /* General empty state that might be used in chat for other purposes */
    text-align: center;
    padding: var(--spacing-lg);
    color: var(--text-secondary);
}

.empty-state p {
    margin-bottom: var(--spacing-md);
    font-size: 13px;
}

/* 视频预览容器样式 */
.video-preview-container {
    margin: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    background-color: var(--card-background);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
    max-width: 100%;
    box-sizing: border-box;
}

/* 视频网格布局 */
.videos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: var(--spacing-xs);
    padding: var(--spacing-xs);
}

.video-item {
    position: relative;
    height: 120px;
    border-radius: var(--radius-sm);
    overflow: hidden;
    background: #000;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.video-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.video-thumbnail {
    width: 100%;
    height: 80px;
    object-fit: cover;
}

.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.2s ease;
}

.video-item:hover .video-overlay {
    opacity: 1;
}

.video-play-icon {
    color: white;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
}

.video-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
    color: white;
    font-size: 11px;
    display: flex;
    align-items: center;
    padding: 0 8px;
    gap: 8px;
}

.video-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    font-weight: 500;
}

.video-size {
    font-size: 9px;
    color: #ccc;
    flex-shrink: 0;
}

.video-actions {
    position: absolute;
    top: var(--spacing-xs);
    right: var(--spacing-xs);
    display: flex;
    gap: var(--spacing-xs);
    opacity: 0;
    transition: opacity 0.2s ease;
}

.video-item:hover .video-actions {
    opacity: 1;
}

/* 视频预览操作按钮 */
.video-action-button {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-full);
    border: none;
    background-color: rgba(255, 255, 255, 0.9);
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(4px);
}

.video-action-button:hover {
    background-color: white;
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.video-action-button svg {
    width: 16px;
    height: 16px;
}

/* 用户消息中的视频网格 */
.user-message .message-videos {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-xs);
}

.user-message .message-video {
    width: 100%;
    height: 90px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    overflow: hidden;
    background: #000;
    position: relative;
}

.user-message .message-video .video-thumbnail {
    width: 100%;
    height: 70px;
    object-fit: cover;
}

.user-message .message-video .video-info {
    height: 20px;
    font-size: 10px;
    padding: 0 6px;
}

/* 统一模态框样式 */
.dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        backdrop-filter: blur(0px);
    }

    to {
        opacity: 1;
        backdrop-filter: blur(4px);
    }
}

.dialog-content {
    background: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    width: 90%;
    max-width: 400px;
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    animation: slideInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: scale(1);
    z-index: 10001;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.dialog-content h3 {
    font-size: 16px;
    margin-bottom: var(--spacing-md);
    color: var(--text-color);
    font-weight: 600;
}

.dialog-content p {
    margin-bottom: var(--spacing-md);
    font-size: 14px;
    line-height: 1.5;
    color: var(--text-secondary);
}

.dialog-content input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--input-background);
    color: var(--text-color);
    font-size: 14px;
    margin-bottom: var(--spacing-lg);
    box-sizing: border-box;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateY(0);
}

.dialog-content input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(49, 123, 245, 0.1);
    background-color: var(--card-background);
    transform: translateY(-1px);
}

.dialog-actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
}

.dialog-actions button {
    border: none;
    border-radius: var(--radius-lg);
    padding: var(--spacing-sm) var(--spacing-lg);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 80px;
    transform: scale(1);
    position: relative;
    overflow: hidden;
}

.dialog-actions button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
}

.cancel-btn {
    background: var(--button-secondary-bg);
    color: var(--button-secondary-text);
}

.cancel-btn:hover {
    background: var(--button-secondary-hover);
    transform: scale(1.02);
}

.cancel-btn:hover::before {
    width: 100%;
    height: 100%;
}

.confirm-btn {
    background: var(--primary-color);
    color: white;
}

.confirm-btn:hover {
    background: var(--secondary-color);
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(49, 123, 245, 0.3);
}

.confirm-btn:hover::before {
    width: 100%;
    height: 100%;
}

.confirm-btn:disabled {
    background: var(--border-color);
    color: var(--text-secondary);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.confirm-btn:disabled::before {
    display: none;
}

/* 导入选项样式 */
.import-options {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md);
    background: var(--background-color);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
}

.radio-label {
    display: flex !important;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    margin-bottom: var(--spacing-sm) !important;
    padding: var(--spacing-sm);
    border-radius: var(--radius-sm);
    transition: background-color 0.2s ease;
}

.radio-label:last-child {
    margin-bottom: 0 !important;
}

.radio-label:hover {
    background-color: var(--button-hover-bg);
}

.radio-label input[type="radio"] {
    width: auto !important;
    margin: 0 !important;
    opacity: 0;
    position: absolute;
    pointer-events: none;
}

.radio-mark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    position: relative;
}

.radio-label input[type="radio"]:checked+.radio-mark {
    border-color: var(--primary-color);
    background-color: var(--primary-color);
}

.radio-label input[type="radio"]:checked+.radio-mark::after {
    content: '';
    width: 6px;
    height: 6px;
    background-color: white;
    border-radius: 50%;
    position: absolute;
}

/* 重复信息样式 */
.duplicate-info {
    margin: var(--spacing-sm) 0;
    padding: var(--spacing-sm);
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: var(--radius-sm);
}

.duplicate-info p {
    margin: 0 !important;
    font-size: 13px !important;
    color: var(--warning-color) !important;
}


.delete-btn:hover::before {
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.1);
}

/* 已选标签栏 */
.selected-tabs-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: calc(var(--spacing-sm) + 2px) var(--spacing-md);
    /* 增加上下内边距2px */
    background-color: rgba(255, 255, 255, 0.85);
    /* 半透明背景，适用于亮色模式 */
    border-bottom: 1px solid var(--border-color);
    overflow: hidden;
    max-width: 100%;
    box-sizing: border-box;
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    border-top: 1px solid var(--border-color);
    white-space: nowrap;
    flex-shrink: 1;

    /* 增强磨玻璃效果 */
    backdrop-filter: blur(10px) saturate(130%);
    -webkit-backdrop-filter: blur(10px) saturate(130%);

    /* 轻微的阴影效果增强立体感 */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03) inset;

    /* 添加渐变边框效果 */
    background-image: linear-gradient(135deg,
            rgba(255, 255, 255, 0.1) 0%,
            rgba(255, 255, 255, 0.05) 50%,
            rgba(255, 255, 255, 0.02) 100%);
}

/* 深色模式下已选标签栏 */
body.dark-mode .selected-tabs-bar {
    background-color: rgba(44, 46, 51, 0.85);
    /* 深色模式下的半透明背景，与卡片背景协调 */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) inset;
    border-color: var(--border-color);
    background-image: linear-gradient(135deg,
            rgba(60, 60, 65, 0.1) 0%,
            rgba(40, 40, 45, 0.05) 50%,
            rgba(30, 30, 35, 0.02) 100%);
}


.chat-input-area .chat-input {
    /* 当标签栏存在时，chat-input 的顶部边框由标签栏提供 */
    border-top: none;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

.selected-tab-chip {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    background-color: rgba(255, 255, 255, 0.6);
    /* 更透明的背景，配合磨玻璃效果 */
    border: 1px solid rgba(233, 236, 239, 0.8);
    /* 半透明边框 */
    border-radius: var(--radius-full);
    padding: calc(var(--spacing-xs) + 3px) var(--spacing-sm);
    /* 上下内边距 */
    padding-left: calc(var(--spacing-sm) + 2px);
    /* 增加左侧内边距，让图标不靠近边缘 */
    font-size: 12px;
    color: var(--text-color);
    cursor: default;
    transition: all 0.2s ease;
    flex-grow: 1;
    /* 允许增长 */
    flex-shrink: 1;
    /* 允许收缩 */
    flex-basis: 0;
    /* 初始大小为0，让flex-grow和flex-shrink平均分配空间 */
    min-width: 40px;
    /* 减小最小宽度，允许更多压缩 */
    max-width: 200px;
    /* 最大宽度限制 */
    overflow: hidden;

    /* 轻微的阴影增强立体感 */
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);

    /* 磨玻璃效果 */
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);

    /* 空间不足时优化显示 */
    position: relative;
    margin: 0 1px;
    /* 添加小间距，提高可区分度 */
}

/* 当标签很多、空间不足时，优先保留图标和关闭按钮，文本优雅压缩 */
@media (max-width: 600px),
(min-width: 601px) and (max-width: 900px) {
    .selected-tab-chip {
        padding: calc(var(--spacing-xs) + 3px) var(--spacing-xs);
        /* 保持增加的上下内边距 */
        padding-left: calc(var(--spacing-xs) + 4px);
        /* 在小屏幕上也增加左侧内边距 */
        min-width: 32px;
        /* 进一步减小最小宽度 */
    }

    /* 当宽度低于特定值时，文本可以完全隐藏，只保留图标和关闭按钮 */
    .selected-tab-chip.micro {
        min-width: 32px;
        width: 32px;
        padding: calc(var(--spacing-xs) + 3px) calc(var(--spacing-xs) / 2);
        /* 保持增加的上下内边距 */
        /* 微型模式下居中显示，无需特别设置左侧内边距 */
        justify-content: center;
    }

    .selected-tab-chip.micro span {
        display: none;
    }
}

/* 深色模式下的标签芯片 */
body.dark-mode .selected-tab-chip {
    background-color: rgba(52, 58, 64, 0.7);
    /* 深色模式下的半透明背景 */
    border-color: rgba(52, 58, 64, 0.9);
    /* 深色模式下的边框 */
    color: var(--text-color);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
}

.selected-tab-chip:hover,
.selected-tab-chip.active {
    border-color: rgba(70, 116, 255, 0.5);
    /* 半透明主色调边框 */
    background-color: rgba(70, 116, 255, 0.08);
    /* 主色调透明背景 */
    color: var(--primary-color);
    /* 不使用悬浮上抬效果，但稍微增加阴影 */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
}

/* 深色模式下的悬停样式 */
body.dark-mode .selected-tab-chip:hover,
body.dark-mode .selected-tab-chip.active {
    border-color: rgba(116, 143, 252, 0.5);
    background-color: rgba(116, 143, 252, 0.15);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.selected-tab-chip img {
    width: 16px;
    /* 增加图标大小 */
    height: 16px;
    /* 增加图标大小 */
    border-radius: 3px;
    object-fit: contain;
    flex-shrink: 0;
}

.selected-tab-chip span {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex-grow: 1;
    min-width: 0;
    font-weight: 500;
    /* 稍微加粗文字 */
}

.selected-tab-chip button {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 14px;
    padding: 0;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: var(--spacing-xs);
    cursor: pointer;
    line-height: 1;
    opacity: 0.7;
    flex-shrink: 0;
    border-radius: var(--radius-full);
    transition: all 0.2s ease;
}

.selected-tab-chip button:hover {
    color: var(--error-color);
    opacity: 1;
    background-color: rgba(201, 42, 42, 0.1);
    transform: scale(1.1);
    /* 稍微放大按钮增强交互感 */
}

/* 深色模式下的关闭按钮悬停效果 */
body.dark-mode .selected-tab-chip button:hover {
    background-color: rgba(255, 135, 135, 0.15);
}

.selected-tab-chip.loading {
    color: var(--primary-color);
    border-color: rgba(70, 116, 255, 0.3);
    background-color: rgba(70, 116, 255, 0.05);
}

/* 深色模式下的加载状态 */
body.dark-mode .selected-tab-chip.loading {
    border-color: rgba(116, 143, 252, 0.3);
    background-color: rgba(116, 143, 252, 0.08);
}

.selected-tab-chip.error {
    color: var(--error-color);
    border-color: rgba(201, 42, 42, 0.3);
    background-color: rgba(201, 42, 42, 0.05);
}

/* 深色模式下的错误状态 */
body.dark-mode .selected-tab-chip.error {
    border-color: rgba(255, 135, 135, 0.3);
    background-color: rgba(255, 135, 135, 0.08);
}

.tab-chip-spinner {
    width: 12px;
    height: 12px;
    border: 2px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: chip-spinner-anim 0.8s linear infinite;
    margin-left: var(--spacing-xs);
}

@keyframes chip-spinner-anim {
    to {
        transform: rotate(360deg);
    }
}


/* 标签页选择弹窗 - 增强磨玻璃效果 */
.tab-selection-popup {
    position: fixed;
    /* 使用 fixed 定位 */
    z-index: 10010;
    /* 比 sidepanel 内其他元素高，但低于模态框等 */
    border: 1px solid rgba(233, 236, 239, 0.5);
    /* 半透明边框，替代 var(--border-color-glass) */
    border-radius: var(--radius-xl);
    /* 更大的圆角 */
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 20px 60px rgba(0, 0, 0, 0.15);
    /* 更深的阴影层次，替代 var(--shadow-glass) */
    max-height: 320px;
    /* 稍微增加高度 */
    overflow-y: auto;
    padding: 0;
    /* 移除内边距，避免顶部和底部留白 */

    /* 增强的磨玻璃效果 - 使用明确的背景颜色替代 var(--glass-bg-color) */
    background-color: rgba(255, 255, 255, 0.85);
    /* 半透明背景 */
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);

    /* 渐变边框效果 */
    background-image: linear-gradient(135deg,
            rgba(255, 255, 255, 0.15) 0%,
            rgba(255, 255, 255, 0.05) 50%,
            rgba(255, 255, 255, 0.02) 100%);

    /* 入场动画 */
    animation: popupSlideIn 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    transform-origin: center bottom;
}

/* 深色模式下标签页选择弹窗 */
body.dark-mode .tab-selection-popup {
    border-color: rgba(52, 58, 64, 0.6);
    background-color: rgba(44, 46, 51, 0.85);
    /* 深色模式下的半透明背景 */
    background-image: linear-gradient(135deg,
            rgba(70, 70, 70, 0.15) 0%,
            rgba(40, 40, 40, 0.05) 50%,
            rgba(20, 20, 20, 0.02) 100%);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15), 0 20px 60px rgba(0, 0, 0, 0.25);
}

/* 弹窗入场动画 */
@keyframes popupSlideIn {
    0% {
        opacity: 0;
        transform: translateY(8px) scale(0.95);
        backdrop-filter: blur(4px) saturate(100%);
        -webkit-backdrop-filter: blur(4px) saturate(100%);
    }

    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
    }
}

/* 弹窗滚动条美化 */
.tab-selection-popup::-webkit-scrollbar {
    width: 6px;
}

.tab-selection-popup::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-full);
    margin: 0;
    /* 移除上下边距，避免留白 */
}

.tab-selection-popup::-webkit-scrollbar-thumb {
    background: rgba(70, 116, 255, 0.3);
    border-radius: var(--radius-full);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
}

.tab-selection-popup::-webkit-scrollbar-thumb:hover {
    background: rgba(70, 116, 255, 0.5);
}

.tab-selection-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.tab-selection-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.15s ease;
    margin: 0;
    /* 确保没有外边距 */
}

.tab-selection-item:first-child {
    border-top-left-radius: var(--radius-xl);
    /* 与弹窗圆角一致 */
    border-top-right-radius: var(--radius-xl);
}

.tab-selection-item:last-child {
    border-bottom: none;
    border-bottom-left-radius: var(--radius-xl);
    /* 与弹窗圆角一致 */
    border-bottom-right-radius: var(--radius-xl);
}

.tab-selection-item:hover {
    background-color: var(--button-hover-bg);
    color: var(--primary-color);
}

/* 列表项的键盘聚焦样式 */
/* 取消聚焦高亮的背景，保持极简；若需可改为细边框或阴影 */
.tab-selection-item.focused {
    background-color: transparent;
}

/* 多选勾选后的样式：不改变背景，仅通过右侧勾选指示器体现 */

.tab-item-favicon {
    width: 16px;
    height: 16px;
    object-fit: contain;
    flex-shrink: 0;
    border-radius: 2px;
}

.tab-item-title {
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
    min-width: 0;
    /* 确保在 flex 容器中可以缩小 */
}

.tab-item-url {
    font-size: 11px;
    color: var(--text-tertiary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    /* 使用标准省略，移除渐变效果 */
    flex-shrink: 1;
    /* 允许 URL 缩小 */
    max-width: 40%;
    /* 限制 URL 最大宽度 */
    /* 移除 position: relative，不再使用渐变效果 */
}

/* 移除URL渐变效果，避免右侧留白 */
/* .tab-item-url::after 相关样式已移除 */

.tab-selection-item.no-results {
    justify-content: center;
    color: var(--text-secondary);
    cursor: default;
    padding: var(--spacing-md);
}

/* 勾选指示器（列表项右侧的小对勾），默认淡显，选中时高亮为绿色 */
.check-indicator {
    margin-left: auto;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 1.5px solid var(--border-color);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: transparent;
    /* 让 svg 使用 currentColor，但未选中时透明 */
    background: transparent;
    opacity: 0.5;
    transition: all 0.15s ease;
}

.check-indicator svg {
    width: 12px;
    height: 12px;
}

.tab-selection-item.checked .check-indicator {
    border-color: rgba(16, 185, 129, 0.6);
    background: rgba(16, 185, 129, 0.12);
    color: rgba(16, 185, 129, 1);
    opacity: 1;
}

body.dark-mode .tab-selection-item.checked .check-indicator {
    border-color: rgba(16, 185, 129, 0.8);
    background: rgba(16, 185, 129, 0.25);
    color: rgba(140, 255, 215, 1);
}

/* 弹窗底部操作按钮区域 */
.tab-selection-actions {
    position: sticky;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: inherit;
    backdrop-filter: inherit;
    -webkit-backdrop-filter: inherit;
    border-top: 1px solid var(--border-color);
}

.tab-selection-actions .left-actions,
.tab-selection-actions .right-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.tab-selection-actions .tab-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    border: 1px solid var(--border-color);
    background: var(--button-bg);
    color: var(--text-primary);
    cursor: pointer;
    transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease, box-shadow 0.15s ease;
}

.tab-selection-actions .tab-action:hover {
    background: var(--button-hover-bg);
    border-color: var(--primary-color);
    color: var(--primary-color);
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
}

.tab-selection-actions .tab-action.neutral:hover {
    background: rgba(76, 110, 245, 0.16);
    border-color: rgba(76, 110, 245, 0.5);
    color: var(--primary-color);
}

.tab-selection-actions .tab-action.confirm:hover {
    background: rgba(16, 185, 129, 0.2);
    border-color: rgba(16, 185, 129, 0.6);
    color: rgb(16, 185, 129);
}

.tab-selection-actions .tab-action.cancel:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.6);
    color: rgb(239, 68, 68);
}

.tab-selection-actions .tab-action.neutral {
    border-color: rgba(99, 123, 255, 0.35);
    background: rgba(99, 123, 255, 0.12);
    color: rgba(76, 110, 245, 1);
}

.tab-selection-actions .tab-action.confirm {
    border-color: rgba(16, 185, 129, 0.35);
    background: rgba(16, 185, 129, 0.12);
    color: rgb(16, 185, 129);
}

.tab-selection-actions .tab-action.cancel {
    border-color: rgba(239, 68, 68, 0.35);
    background: rgba(239, 68, 68, 0.12);
    color: rgb(239, 68, 68);
}

/* 深色模式下的按钮配色调整，确保可读性和对比度 */
body.dark-mode .tab-selection-actions .tab-action.neutral {
    border-color: rgba(99, 123, 255, 0.5);
    background: rgba(99, 123, 255, 0.22);
    color: rgba(180, 195, 255, 1);
}

body.dark-mode .tab-selection-actions .tab-action.confirm {
    border-color: rgba(16, 185, 129, 0.5);
    background: rgba(16, 185, 129, 0.22);
    color: rgba(140, 255, 215, 1);
}

body.dark-mode .tab-selection-actions .tab-action.cancel {
    border-color: rgba(239, 68, 68, 0.5);
    background: rgba(239, 68, 68, 0.22);
    color: rgba(255, 180, 180, 1);
}

/* ============================================
   Mermaid Streaming Refinements
   ============================================ */

/* 
   During streaming, disable pointer events and transitions on the message bubble 
   to prevent "hover bounce" (repeated zooming/shifting due to rapid DOM updates).
*/
.message.streaming {
    pointer-events: none !important;
    transform: none !important;
    transition: none !important;
}

/* 
   Ensure Mermaid container takes full width.
   This prevents the diagram from being squeezed into a narrow column 
   during streaming before it's fully rendered/sized by the library.
   
   min-width ensures that even if the bubble is narrow, the mermaid
   container is wide enough for reasonable rendering.
*/
.mermaid {
    width: 100%;
    min-width: 300px;
    overflow-x: auto;
    /* Hide scrollbars to prevent flicker, but keep scroll functionality */
    scrollbar-width: none;
    /* Firefox */
    -ms-overflow-style: none;
    /* IE/Edge */
}

.mermaid::-webkit-scrollbar {
    display: none;
    /* Chrome/Safari */
}

/* 
   Make the SVG responsive - scale with container width.
*/
.mermaid svg {
    width: 100%;
    max-width: 100%;
    height: auto;
    display: block;
}

/* 
   Force the message bubble to take full width if it contains a mermaid diagram.
   This ensures the diagram has maximum space to render correctly from the start,
   avoiding the "small diagram" issue during streaming.
*/
.bot-message:has(.mermaid) {
    width: 100%;
}